<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>注册</title>
  <!-- 引入bootstrap.css -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css">
  <!-- 引入 Font Awesome 图标库 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    body {
      background: url('../static/image/register.jpg') no-repeat center center fixed;
      background-size: cover;
      width: 100%;
      height: 100vh;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
    }

    .container {
      width: 450px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      padding: 40px;
      box-sizing: border-box;
      border-radius: 25px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      z-index: 1;
      animation: fadeInUp 0.8s ease-out;
      position: relative;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container h3 {
      font-weight: 600;
      text-align: center;
      color: #fff;
      margin-bottom: 30px;
      letter-spacing: 1px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .system-description {
      color: #fff;
      text-align: center;
      margin-bottom: 30px;
      font-size: 14px;
      opacity: 0.8;
    }

    .form_wrap {
      color: #fff !important;
    }

    .form-text {
      color: #fff !important;
    }

    .btn {
      width: 100%;
      height: 50px;
      background: linear-gradient(135deg, #00C9FF, #92FE9D);
      border: none;
      border-radius: 30px;
      color: #fff;
      font-size: 18px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 201, 255, 0.3);
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(0, 201, 255, 0.5);
    }
    .error-message {
      color: #ff6b6b;
      font-size: 12px;
      display: block;
      margin-left: 30px;
      margin-bottom: 8px;
    }

    .input-group-text {
      background-color: rgba(255, 255, 255, 0.2);
      border-right: none;
      color: #fff;
      border-radius: 30px 0 0 30px;
      transition: background-color 0.3s ease;
    }

    .form-control {
      border-left: none;
      background-color: rgba(255, 255, 255, 0.2);
      color: #fff;
      border-radius: 0 30px 30px 0;
      transition: background-color 0.3s ease;
    }

    .form-control::placeholder {
      color: #fff;
      opacity: 0.8;
    }

    .form-control:focus {
      box-shadow: none;
      border-color: #fff;
      background-color: rgba(255, 255, 255, 0.3);
      color: #fff;
    }

    .input-group:hover .input-group-text,
    .input-group:hover .form-control {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* 教室监控元素样式 */
    .monitor-element {
      position: absolute;
      width: 150px;
      top: 10%;
      left: 10%;
      opacity: 0.8;
      animation: rotate 10s linear infinite;
    }

    .monitor-element-2 {
      position: absolute;
      width: 120px;
      bottom: 10%;
      right: 10%;
      opacity: 0.8;
      animation: float 3s ease-in-out infinite;
    }

    /* 更换的教室监控元素样式 */
    .monitor-element-3 {
      position: absolute;
      width: 180px;
      top: 30%;
      right: 15%;
      opacity: 0.9;
      animation: swing 5s ease-in-out infinite;
    }

    @keyframes rotate {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-20px);
      }
    }

    @keyframes swing {
      0%, 100% {
        transform: rotate(0deg);
      }
      50% {
        transform: rotate(20deg);
      }
    }
  </style>
</head>

<body>
  <!-- 教室监控元素 -->
  <img class="monitor-element" src="https://cdn-icons-png.flaticon.com/512/2989/2989712.png" alt="教室监控">
  <img class="monitor-element-2" src="https://cdn-icons-png.flaticon.com/512/2989/2989712.png" alt="教室监控">
  <!-- 更换的教室监控元素 -->
  <img class="monitor-element-3" src="https://cdn-icons-png.flaticon.com/512/3274/3274077.png" alt="新教室监控">
  <div class="container">
    <h3>欢迎-注册</h3>
    <p class="system-description">注册智能巡课系统，开启高效便捷的校园巡课体验！</p>
    <!-- 表单 -->
    <div class="form_wrap">
      <!-- 给表单添加 id -->
      <form class="register-form" id="registerForm" method="post" action="{% url 'register' %}">
        {% csrf_token %}
        <div class="mb-3 input-group">
          <span class="input-group-text">
            <i class="fa-solid fa-phone"></i>
          </span>
          <input type="text" class="form-control phone" name="phone" placeholder="手机号" required>
        </div>
        <span class="error-message"></span>
        <div class="mb-3 input-group">
          <span class="input-group-text">
            <i class="fa-solid fa-user"></i>
          </span>
          <input type="text" class="form-control username" name="username" placeholder="账号名" required>
        </div>
        <span class="error-message"></span>
        <div class="mb-3 input-group">
          <span class="input-group-text">
            <i class="fa-solid fa-lock"></i>
          </span>
          <input type="password" class="form-control password1" name="password1" placeholder="密码" required>
        </div>
        <span class="error-message"></span>
        <div class="mb-3 input-group">
          <span class="input-group-text">
            <i class="fa-solid fa-lock"></i>
          </span>
          <input type="password" class="form-control password2" name="password2" placeholder="确认密码" required>
        </div>
        <span class="error-message"></span>
        <button type="submit" class="btn btn-primary btn-login"> 注 册 </button>
        <p class="mt-3 text-center">
          已有账号？<a href="{% url 'login' %}">立即登录</a>
        </p>
      </form>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    function alertFn(msg, isSuccess) {
      const type = isSuccess ? '成功' : '失败';
      alert(`${type}: ${msg}`);
    }

    // 手机号验证
    const phone = document.querySelector('[name=phone]');
    phone.addEventListener('change', verifyPhone);
    function verifyPhone() {
      const span = phone.parentNode.nextElementSibling;
      const reg = /^1(3\d|4[5-9]|5[0-35-9]|6[567]|7[0-8]|8\d|9[0-35-9])\d{8}$/;
      if (!reg.test(phone.value)) {
        span.innerText = '输入不合法，请输入正确的 11 位手机号！';
        return false;
      }
      span.innerText = '';
      return true;
    }

    // 密码验证
    function verifyPassword() {
      const password1 = document.querySelector('[name=password1]');
      const password2 = document.querySelector('[name=password2]');
      const span = password2.parentNode.nextElementSibling;

      if (password1.value.length < 6) {
        span.innerText = '密码长度不能小于6位！';
        return false;
      }

      if (password1.value !== password2.value) {
        span.innerText = '两次输入的密码不一致！';
        return false;
      }

      span.innerText = '';
      return true;
    }

    // 表单提交
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      if (!verifyPhone() || !verifyPassword()) {
        return;
      }

      const formData = new FormData(this);
      try {
        const response = await axios.post(this.action, formData);
        if (response.data.status === 'success') {
          // 注册成功后跳转到登录页面
          window.location.href = '/monitor/login/';
        } else {
          let errorMessage = response.data.message;
          if (response.data.errors) {
            errorMessage += '\n' + response.data.errors.join('\n');
          }
          alertFn(errorMessage, false);
        }
      } catch (error) {
        let errorMessage = '注册失败，请稍后重试';
        if (error.response && error.response.data) {
          errorMessage = error.response.data.message || errorMessage;
          if (error.response.data.errors) {
            errorMessage += '\n' + error.response.data.errors.join('\n');
          }
        }
        alertFn(errorMessage, false);
      }
    });
  </script>
</body>

</html>